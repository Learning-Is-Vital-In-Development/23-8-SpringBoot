## 메트릭 등록
메트릭은 약간의 오차가 존재할수있다.실시간으로 데이터를 대략적으로 보는것을 목적으로 한다. 



비즈니스 특화된 부분을 모니터링(주문수, 취소수, 등)하고싶다면 메트릭을 직접등록해서 확인해야한다. 

스프링을 통해 **마이크로미터**를 주입받고 카운터,게이지 등을 등록한다.



### 카운터

- 하나씩 증가하는 단일 값
- HTTP 요청수 같은걸 카운팅 할수있다.

### 타이머 

- 시간을 측정하는데 사용한다
- 실행시간(누적 실행수, 최대 실행시간, 누적 실행카운트)을 측정한다.
  - 내부에 타임 윈도우라는것이 있어서 1~3분마다 최대 실행시간이 다시 계산된다.


### 게이지
- 값의 상태를 보는데 사용
- CPU 사용량, 메모리사용량 
- 값이 증가되거나 감소할수있음
- 값의 감소 가능성을 고민해보고 카운터와 구별할수있다.


## 실무 모니터링 환경 구성 팁

#### 대시보드

- 전체를 한눈에 볼수있는 화면
- 시스템 메트릭(CPU,메모리)
- 애플리케이션 메트릭(톰캣 쓰레드 풀, DB 커넥션 풀, 애플리케이션 호출수)
- 비즈니스 메트릭(주문,취소수)
#### 애플리케이션 추적
- HTTP 요청 하나하나를 추적하는것
- 마이크로 서비스 환경에선 분산 추적이 가능하다
- **핀포인트**, 스카우트, 제니퍼 ...

#### 로그

- 가장 세세한 추적
- 어떤 사용자가 호출했는지 알수있도록 묶어서 남기는것이 중요하다
  - 고객 요청이 들어올때 UUID 같은것을 생성해 같이남기는 방법 등
  - MDC를 이용할수있다.
  
- 파일로 직접 로그 남기는 경우
  - 일반로그, 에러로그를 별도의 파일로 구분해서 남기는것이 좋다
  
- 클라우드에 로그 남기는 경우
  - 검색을통해 잘 찾을수있도록 구분하는것이 좋다


#### 알람

- 경고: 하루에 한번 사람이 직접 확인해도 되는 수준
  - 디스크 사용량 70%
  - CPU 사용량 40%
- 심각: 즉시 확인해야함(슬랙, 문자 , 전화)
  - 디스크 사용량 80%
  - CPU 사용량 50%
  
- 경고,심각과같은 정말 중요한 알람만 등록하는것이 좋을수있다. 
