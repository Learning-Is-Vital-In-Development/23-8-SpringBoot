
# 2. 웹 서버와 서블릿 컨테이너
 
# 2-1. 웹 서버와 스프링 부트소개

## 전통적 방식 (외장 서버)

- 서버에 톰캣같은 WAS(웹 어플리케이션)를 설치
- WAS에서 동작하도록 서블릿 스펙에 맞춰 코드를 작성 , WAR 형식으로 빌드해 war 파일을 만듬
- 그리고 만들어진 war을 WAS에 전달해서 배포하는 방식

## 최근 방식(내장 서버)

- 스프링 부트가 내장 톰캣을 포함하고 있음.  즉 어플리케이션 코드 안에 톰캣같은 WAS가 라이브러리로 내장되어 있음.
- 개발자는 코드를 작성하고, 자바를 JAR 파일로 빌드해서 원하는 위치에서 실행하면 WAS도 함께 실행된다. 그래서 개발자는 main메소드만 실행하면 된다.

그렇다면 스프링 부트는 어떤 원리로 내장 톰캣을 사용해서 실행 할 수 있는 것일까?


# 2-2. 톰캣 설치

### 서블릿(Servlet)?

자바 서블릿은 웹페이지를 동적으로 생성하는 서버
즉, 클라이언트의 요청에 맞춰 동적인 결과를 만들어 주는 자바 웹 프로그래밍 기술
이러한 서블릿은 톰캣같은 WAS(Web Application Server)의 서블릿 컨테이너 안에서 동작하게 된다.


# 2-4 . WAR 빌드와 배포

## JAR와 WAR의 차이

### JAR(Java Archive)

자바는 여러 클래스와 리소트를 묶어서 JAR라는 압축 파일을 만들 수 있다. 이 파일은 JVM위에서 직접 실행되거나 다른 곳에서 사용하는 라이브러리로 제공된다.

따라서 직접 실행하는 경우 main() 메서드가 필요하고, MANIFEST.MF 라는 파일에 실행할 메인 메서드가 있는 클래스를 지정해두어야한다.

### WAR(Web Application Archive)

war는 이름에서 알수 있듯이 웹 어플리케이션 서버(WAS)에 배포할때 사용하는 파일이다. JVM위에서 실행되는 JAR와 달리 웹 어플리케이션 서버위에서 실행된다.

HTML 같은 정적 리소스와 클래스 파일을 모두 함께 포함하기 때문에 JAR와 비교해서 구조가 더 복잡하다.

### WAR 구조

- WEB-INF
    - classes : 실행 클래스 모음
    - lib : 라이브러리 모음
    - web.xml. : 웹 서버 배치 설정 파일 (생략가능)
- index.html : 정적 리소스


# 2-5. 서블릿 컨테이너 초기화

WAS를 실행하는 시점에 필요한 초기화 작업들이 있다.
서비스에 필요한 필터와 서블릿을 등록하고, 스프링을 사용한다면 스프링 컨테이너를 만들고, 서블릿과 스프링을 연결하는 디스패치 서블릿도 등록해야한다.

서블릿을 등록하는 방법에는 2가지가 존재함. 
1. @WebServlet 애노테이션
2. 프로그래밍 방식  : 어노테이션을 사용하면 서블릿을 편리하게 사용할수있지만,  유연하게 사용하기가 힘들다. 따라서 프로그래밍 방식을 사용
   **어플리케이션 초기화**

서블릿 컨테이너는 더 나아가 조금 더 유연한 기능을 제공하는데
이를 @HandlesTypes를 사용하는 어플리케이션 초기화라고 한다.



### 어플리케이션 초기화 과정

1. @HandlesTypes 애노테이션에 애플리케이션 초기화 인터페이스를 지정한다.
2. .서블릿 컨테이너 초기화( ServletContainerInitializer )는 파라미터로 넘어오는 Set<Class<?>>
3. appInitClass.getDeclaredConstructor().newInstance()
4. appInit.onStartup(ctx)

# 2-5. 스프링 컨테이너 등록

서플릿 컨테이너 초기화와 어플리케이션 초기화를 활용하면 된다.

### 필요한 과정

1. 스프링 컨테이너 만들기
2. 스프링 MVC 컨트롤러를 스프링 컨테이너 빈으로 등록하기
3. 스프링 MVC를 사용하는 필요한 디스패치 서블릿을 서블릿 컨테이너에 등록하기
    - 디스패치 서블릿이란 컨트롤러들을 호출하는 서블릿!그래서 호출이 들어오면 디스패처 서블릿에서 컨트롤러를 호출하는 과정

# 2-6. 스프링 MVC 서블릿 컨테이너 초기화 지원

위의 과정은 매우 반복되는 번거로운 작업이다.

스프링 MVC는 이러한 서블릿 컨테이너 초기화 작업을 이미 만들어두었고, 어플리케이션 초기화 코드만 작성하면 된다. 
**`WebApplicationInitializer`** 얘만 구현하면 된다.

일반적으로는 스프링 컨테이너는 하나를 만들고, 디스패처 서블릿도 하나만 만든다. 그리고 디스패처 서블릿 경로도 /로 해서 하나의 디스패처 서블릿을 통해 모든 것을 처리하도록 만든다. 